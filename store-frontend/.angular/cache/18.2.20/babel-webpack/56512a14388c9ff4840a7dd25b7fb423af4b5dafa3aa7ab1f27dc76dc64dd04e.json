{"ast":null,"code":"import { catchError } from \"rxjs\";\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/common/http\";\nconst USER_URL = '/store/api/users';\nconst BASE_URL = '/store/api/auth';\nconst ORDER_URL = '/store/api/orders';\nexport let UserService = /*#__PURE__*/(() => {\n  class UserService {\n    //constructor\n    constructor(https) {\n      this.https = https;\n      this.logged = false;\n      this.reqIsLogged();\n    }\n    reqIsLogged() {\n      this.https.get(USER_URL + '/current', {\n        withCredentials: true\n      }).subscribe(response => {\n        this.user = response;\n        this.logged = true;\n      }, error => {\n        if (error.status === 401 || error.status === 403) {\n          this.logged = false;\n          this.user = undefined;\n        } else {\n          console.error('Unexpected error:', error);\n        }\n      });\n    }\n    signin(user, pass) {\n      this.https.post(BASE_URL + \"/login\", {\n        username: user,\n        password: pass\n      }, {\n        withCredentials: true\n      }).subscribe(_ => this.reqIsLogged(), _ => alert(\"Wrong credentials\"));\n    }\n    signout() {\n      return this.https.post(BASE_URL + '/logout', {\n        withCredentials: true\n      }).subscribe(_ => {\n        console.log(\"LOGOUT: succesfully\");\n        this.logged = false;\n        this.user = undefined;\n      });\n    }\n    isLogged() {\n      return this.logged;\n    }\n    isUser() {\n      //return this.user && this.user.rol.indexOf('USER') !== -1;\n      return this.user?.rol?.includes(\"USER\");\n    }\n    isAdmin() {\n      //return this.user && this.user.rol.indexOf('ADMIN') !== -1;\n      return this.user?.rol?.includes(\"ADMIN\");\n    }\n    //getUserImage(id: number | undefined){\n    //    return this.https.get(USER_URL + '/' + id + '/image');\n    //}\n    setUserImage(user, formData) {\n      return this.https.post(USER_URL + '/' + user.id + '/image', formData).pipe(catchError(error => {\n        return this.handleError(error);\n      }));\n    }\n    addUser(user) {\n      return this.https.post(USER_URL + '/new', user).pipe(catchError(error => {\n        return this.handleError(error);\n      }));\n    }\n    //getAdminImage(){\n    //    return this.https.get(USER_URL + '/6/image');\n    //}\n    setCurrentUser(user) {\n      this.user = user;\n    }\n    getCurrentUser() {\n      return this.user;\n    }\n    updateUser(id, user) {\n      return this.https.put(USER_URL + '/' + id + '/update', user).pipe(catchError(error => {\n        return this.handleError(error);\n      }));\n    }\n    getUserOrders(id, tam) {\n      return this.https.get(ORDER_URL + '/user/' + id + '?size=' + tam).pipe(catchError(error => {\n        return this.handleError(error);\n      }));\n    }\n    /*updateUserAddress(id: number, address:Direction){\n        return this.https.put(USER_URL + '/' + id + '/update/address', address).pipe(\n            catchError((error) => {\n                return this.handleError(error)\n            })\n        )as Observable<any>;\n    }*/\n    handleError(error) {\n      throw new Error(\"Method not implemented.\");\n    }\n    static {\n      this.ɵfac = function UserService_Factory(__ngFactoryType__) {\n        return new (__ngFactoryType__ || UserService)(i0.ɵɵinject(i1.HttpClient));\n      };\n    }\n    static {\n      this.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n        token: UserService,\n        factory: UserService.ɵfac,\n        providedIn: 'root'\n      });\n    }\n  }\n  return UserService;\n})();","map":{"version":3,"names":["catchError","USER_URL","BASE_URL","ORDER_URL","UserService","constructor","https","logged","reqIsLogged","get","withCredentials","subscribe","response","user","error","status","undefined","console","signin","pass","post","username","password","_","alert","signout","log","isLogged","isUser","rol","includes","isAdmin","setUserImage","formData","id","pipe","handleError","addUser","setCurrentUser","getCurrentUser","updateUser","put","getUserOrders","tam","Error","i0","ɵɵinject","i1","HttpClient","factory","ɵfac","providedIn"],"sources":["C:\\Users\\mimit\\OneDrive\\Documentos\\GitHub\\VentaOnline-Microservicios\\onlinestore\\store-frontend\\src\\app\\services\\user.service.ts"],"sourcesContent":["import { Injectable } from \"@angular/core\";\r\nimport { HttpClient, HttpHeaders } from '@angular/common/http';\r\nimport { User } from \"../models/User.model\";\r\nimport { Direction } from \"../models/Direction.model\";\r\nimport { catchError, Observable } from \"rxjs\";\r\nimport { UserDTO } from \"../models/UserDTO\";\r\nimport { newUserDTO } from \"../models/newUserDTO\";\r\n\r\nconst USER_URL = '/store/api/users';\r\nconst BASE_URL = '/store/api/auth';\r\nconst ORDER_URL = '/store/api/orders';\r\n\r\n\r\n@Injectable({ providedIn: 'root'})\r\nexport class UserService{\r\n\r\n    logged: boolean = false;\r\n    user: any;\r\n\r\n    //constructor\r\n    constructor(private https: HttpClient){\r\n        this.reqIsLogged(); \r\n    }\r\n\r\n    reqIsLogged(){\r\n        this.https.get<User>(USER_URL + '/current', {withCredentials: true}).subscribe(\r\n            response => {\r\n                this.user = response as User;\r\n                this.logged = true;\r\n            },\r\n            error => {\r\n                if (error.status === 401 || error.status === 403) {\r\n                    this.logged = false;\r\n                    this.user = undefined;\r\n                } else {\r\n                    console.error('Unexpected error:', error);\r\n                }\r\n            }\r\n        )\r\n    }\r\n\r\n    signin(user: string, pass: string) {\r\n\t\tthis.https.post(BASE_URL + \"/login\", { username: user, password: pass }, { withCredentials: true })\r\n\t\t.subscribe(\r\n\t\t\t(_:any) => this.reqIsLogged(),\r\n\t\t\t(_:any) => alert(\"Wrong credentials\")\r\n\t\t);\r\n\t}\r\n\r\n    signout() {\r\n\t\treturn this.https.post(BASE_URL + '/logout', { withCredentials: true })\r\n\t\t.subscribe((_: any) => {\r\n\t\t\tconsole.log(\"LOGOUT: succesfully\");\r\n\t\t\tthis.logged = false;\r\n\t\t\tthis.user = undefined;\r\n\t\t});\r\n\t}\r\n\r\n    isLogged(){\r\n        return this.logged;\r\n    }\r\n\r\n    isUser(){\r\n        //return this.user && this.user.rol.indexOf('USER') !== -1;\r\n        return this.user?.rol?.includes(\"USER\");\r\n    }\r\n\r\n    isAdmin(){\r\n        //return this.user && this.user.rol.indexOf('ADMIN') !== -1;\r\n        return this.user?.rol?.includes(\"ADMIN\");\r\n    }\r\n\r\n    //getUserImage(id: number | undefined){\r\n    //    return this.https.get(USER_URL + '/' + id + '/image');\r\n    //}\r\n\r\n    setUserImage(user: User, formData: FormData){\r\n        return this.https.post(USER_URL + '/' + user.id + '/image', formData).pipe(\r\n            catchError((error) => {\r\n                return this.handleError(error)\r\n            })\r\n        );\r\n    }\r\n\r\n    addUser(user: newUserDTO): Observable<any>{\r\n        return this.https.post(USER_URL + '/new', user).pipe(\r\n            catchError((error) => {\r\n                return this.handleError(error)\r\n            })\r\n        )as Observable<any>;\r\n    }\r\n\r\n    //getAdminImage(){\r\n    //    return this.https.get(USER_URL + '/6/image');\r\n    //}\r\n\r\n\r\n    setCurrentUser(user: User){\r\n        this.user = user;\r\n    }\r\n\r\n    getCurrentUser(){\r\n        return this.user;\r\n    }\r\n\r\n    updateUser(id: number, user:UserDTO): Observable<any>{\r\n        return this.https.put(USER_URL + '/' + id + '/update', user).pipe(\r\n            catchError((error) => {\r\n                return this.handleError(error)\r\n            })\r\n        )as Observable<any>;\r\n    }\r\n\r\n    getUserOrders(id: number, tam: number): Observable<any>{\r\n        return this.https.get(ORDER_URL + '/user/' + id + '?size=' + tam).pipe(\r\n            catchError((error) => {\r\n                return this.handleError(error)\r\n            })\r\n        )as Observable<any>;\r\n    }\r\n\r\n    /*updateUserAddress(id: number, address:Direction){\r\n        return this.https.put(USER_URL + '/' + id + '/update/address', address).pipe(\r\n            catchError((error) => {\r\n                return this.handleError(error)\r\n            })\r\n        )as Observable<any>;\r\n    }*/\r\n\r\n    handleError(error: any): any {\r\n        throw new Error(\"Method not implemented.\");\r\n    }\r\n}"],"mappings":"AAIA,SAASA,UAAU,QAAoB,MAAM;;;AAI7C,MAAMC,QAAQ,GAAG,kBAAkB;AACnC,MAAMC,QAAQ,GAAG,iBAAiB;AAClC,MAAMC,SAAS,GAAG,mBAAmB;AAIrC,WAAaC,WAAW;EAAlB,MAAOA,WAAW;IAKpB;IACAC,YAAoBC,KAAiB;MAAjB,KAAAA,KAAK,GAALA,KAAK;MAJzB,KAAAC,MAAM,GAAY,KAAK;MAKnB,IAAI,CAACC,WAAW,EAAE;IACtB;IAEAA,WAAWA,CAAA;MACP,IAAI,CAACF,KAAK,CAACG,GAAG,CAAOR,QAAQ,GAAG,UAAU,EAAE;QAACS,eAAe,EAAE;MAAI,CAAC,CAAC,CAACC,SAAS,CAC1EC,QAAQ,IAAG;QACP,IAAI,CAACC,IAAI,GAAGD,QAAgB;QAC5B,IAAI,CAACL,MAAM,GAAG,IAAI;MACtB,CAAC,EACDO,KAAK,IAAG;QACJ,IAAIA,KAAK,CAACC,MAAM,KAAK,GAAG,IAAID,KAAK,CAACC,MAAM,KAAK,GAAG,EAAE;UAC9C,IAAI,CAACR,MAAM,GAAG,KAAK;UACnB,IAAI,CAACM,IAAI,GAAGG,SAAS;QACzB,CAAC,MAAM;UACHC,OAAO,CAACH,KAAK,CAAC,mBAAmB,EAAEA,KAAK,CAAC;QAC7C;MACJ,CAAC,CACJ;IACL;IAEAI,MAAMA,CAACL,IAAY,EAAEM,IAAY;MACnC,IAAI,CAACb,KAAK,CAACc,IAAI,CAAClB,QAAQ,GAAG,QAAQ,EAAE;QAAEmB,QAAQ,EAAER,IAAI;QAAES,QAAQ,EAAEH;MAAI,CAAE,EAAE;QAAET,eAAe,EAAE;MAAI,CAAE,CAAC,CAClGC,SAAS,CACRY,CAAK,IAAK,IAAI,CAACf,WAAW,EAAE,EAC5Be,CAAK,IAAKC,KAAK,CAAC,mBAAmB,CAAC,CACrC;IACF;IAEGC,OAAOA,CAAA;MACT,OAAO,IAAI,CAACnB,KAAK,CAACc,IAAI,CAAClB,QAAQ,GAAG,SAAS,EAAE;QAAEQ,eAAe,EAAE;MAAI,CAAE,CAAC,CACtEC,SAAS,CAAEY,CAAM,IAAI;QACrBN,OAAO,CAACS,GAAG,CAAC,qBAAqB,CAAC;QAClC,IAAI,CAACnB,MAAM,GAAG,KAAK;QACnB,IAAI,CAACM,IAAI,GAAGG,SAAS;MACtB,CAAC,CAAC;IACH;IAEGW,QAAQA,CAAA;MACJ,OAAO,IAAI,CAACpB,MAAM;IACtB;IAEAqB,MAAMA,CAAA;MACF;MACA,OAAO,IAAI,CAACf,IAAI,EAAEgB,GAAG,EAAEC,QAAQ,CAAC,MAAM,CAAC;IAC3C;IAEAC,OAAOA,CAAA;MACH;MACA,OAAO,IAAI,CAAClB,IAAI,EAAEgB,GAAG,EAAEC,QAAQ,CAAC,OAAO,CAAC;IAC5C;IAEA;IACA;IACA;IAEAE,YAAYA,CAACnB,IAAU,EAAEoB,QAAkB;MACvC,OAAO,IAAI,CAAC3B,KAAK,CAACc,IAAI,CAACnB,QAAQ,GAAG,GAAG,GAAGY,IAAI,CAACqB,EAAE,GAAG,QAAQ,EAAED,QAAQ,CAAC,CAACE,IAAI,CACtEnC,UAAU,CAAEc,KAAK,IAAI;QACjB,OAAO,IAAI,CAACsB,WAAW,CAACtB,KAAK,CAAC;MAClC,CAAC,CAAC,CACL;IACL;IAEAuB,OAAOA,CAACxB,IAAgB;MACpB,OAAO,IAAI,CAACP,KAAK,CAACc,IAAI,CAACnB,QAAQ,GAAG,MAAM,EAAEY,IAAI,CAAC,CAACsB,IAAI,CAChDnC,UAAU,CAAEc,KAAK,IAAI;QACjB,OAAO,IAAI,CAACsB,WAAW,CAACtB,KAAK,CAAC;MAClC,CAAC,CAAC,CACa;IACvB;IAEA;IACA;IACA;IAGAwB,cAAcA,CAACzB,IAAU;MACrB,IAAI,CAACA,IAAI,GAAGA,IAAI;IACpB;IAEA0B,cAAcA,CAAA;MACV,OAAO,IAAI,CAAC1B,IAAI;IACpB;IAEA2B,UAAUA,CAACN,EAAU,EAAErB,IAAY;MAC/B,OAAO,IAAI,CAACP,KAAK,CAACmC,GAAG,CAACxC,QAAQ,GAAG,GAAG,GAAGiC,EAAE,GAAG,SAAS,EAAErB,IAAI,CAAC,CAACsB,IAAI,CAC7DnC,UAAU,CAAEc,KAAK,IAAI;QACjB,OAAO,IAAI,CAACsB,WAAW,CAACtB,KAAK,CAAC;MAClC,CAAC,CAAC,CACa;IACvB;IAEA4B,aAAaA,CAACR,EAAU,EAAES,GAAW;MACjC,OAAO,IAAI,CAACrC,KAAK,CAACG,GAAG,CAACN,SAAS,GAAG,QAAQ,GAAG+B,EAAE,GAAG,QAAQ,GAAGS,GAAG,CAAC,CAACR,IAAI,CAClEnC,UAAU,CAAEc,KAAK,IAAI;QACjB,OAAO,IAAI,CAACsB,WAAW,CAACtB,KAAK,CAAC;MAClC,CAAC,CAAC,CACa;IACvB;IAEA;;;;;;;IAQAsB,WAAWA,CAACtB,KAAU;MAClB,MAAM,IAAI8B,KAAK,CAAC,yBAAyB,CAAC;IAC9C;;;yCArHSxC,WAAW,EAAAyC,EAAA,CAAAC,QAAA,CAAAC,EAAA,CAAAC,UAAA;MAAA;IAAA;;;eAAX5C,WAAW;QAAA6C,OAAA,EAAX7C,WAAW,CAAA8C,IAAA;QAAAC,UAAA,EADE;MAAM;IAAA;;SACnB/C,WAAW;AAAA","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}